@page "/chainsharp/data/logs"
@inherits PollingComponentBase
@inject IDataContextProviderFactory DataContextFactory

<RadzenText TextStyle="TextStyle.H4" class="rz-mb-4">Logs</RadzenText>

<RadzenDataGrid Data="@_items"
                TItem="Log"
                IsLoading="@IsLoading"
                AllowFiltering="true"
                AllowSorting="true"
                AllowPaging="true"
                PageSize="20"
                PagerHorizontalAlign="HorizontalAlign.Center"
                AllowColumnResize="true"
                FilterMode="FilterMode.CheckBoxList"
                class="rz-datatable-striped">
    <Columns>
        <RadzenDataGridColumn TItem="Log"
                              Property="Id"
                              Title="Id"
                              Width="80px" />
        <RadzenDataGridColumn TItem="Log"
                              Property="MetadataId"
                              Title="Metadata Id"
                              Width="110px" />
        <RadzenDataGridColumn TItem="Log"
                              Property="Level"
                              Title="Level"
                              Width="120px" />
        <RadzenDataGridColumn TItem="Log"
                              Property="Category"
                              Title="Category"
                              Width="200px" />
        <RadzenDataGridColumn TItem="Log"
                              Property="Message"
                              Title="Message"
                              Width="350px" />
        <RadzenDataGridColumn TItem="Log"
                              Property="Exception"
                              Title="Exception"
                              Width="250px" />
    </Columns>
</RadzenDataGrid>

@code {
    private List<Log> _items = [];

    protected override async Task LoadDataAsync(CancellationToken cancellationToken)
    {
        using var context = await DataContextFactory.CreateDbContextAsync(cancellationToken);
        _items = await context.Logs.AsNoTracking().ToListAsync(cancellationToken);
    }
}
